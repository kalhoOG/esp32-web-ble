<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Golf Swing Speed</title>
</head>
<body>
  <h1>Golf Swing Speed Monitor</h1>
  <button id="connectButton">Connect to BLE</button>
  <button id="disconnectButton">Disconnect</button>
  <p>BLE State: <span id="bleState">Disconnected</span></p>

  <h2>Club Head Speed</h2>
  <p>Current Speed: <span id="currentSpeed">0</span> m/s</p>
  <p>Max Speed: <span id="maxSpeed">0</span> m/s</p>
  
  <h3>Last 5 Speeds</h3>
  <ul>
    <li>Speed 1: <span id="speed1">0</span></li>
    <li>Speed 2: <span id="speed2">0</span></li>
    <li>Speed 3: <span id="speed3">0</span></li>
    <li>Speed 4: <span id="speed4">0</span></li>
    <li>Speed 5: <span id="speed5">0</span></li>
  </ul>

  <script>
    let bleDevice;
    let bleCharacteristic;

    document.getElementById('connectButton').addEventListener('click', connectBLE);
    document.getElementById('disconnectButton').addEventListener('click', disconnectBLE);

    function connectBLE() {
      navigator.bluetooth.requestDevice({
        filters: [{ name: 'ESP32 Golf Sensor' }],
        optionalServices: ['19b10000-e8f2-537e-4f6c-d104768a1214']
      })
      .then(device => {
        bleDevice = device;
        document.getElementById('bleState').textContent = 'Connected';
        return device.gatt.connect();
      })
      .then(server => server.getPrimaryService('19b10000-e8f2-537e-4f6c-d104768a1214'))
      .then(service => service.getCharacteristic('19b10003-e8f2-537e-4f6c-d104768a1214'))
      .then(characteristic => {
        bleCharacteristic = characteristic;
        characteristic.addEventListener('characteristicvaluechanged', handleData);
        return characteristic.startNotifications();
      });
    }

    function handleData(event) {
      const value = new TextDecoder().decode(event.target.value);
      const [current, max, s1, s2, s3, s4, s5] = value.split(",");

      document.getElementById('currentSpeed').textContent = current;
      document.getElementById('maxSpeed').textContent = max;
      document.getElementById('speed1').textContent = s1;
      document.getElementById('speed2').textContent = s2;
      document.getElementById('speed3').textContent = s3;
      document.getElementById('speed4').textContent = s4;
      document.getElementById('speed5').textContent = s5;
    }

    function disconnectBLE() {
      if (bleDevice) {
        bleDevice.gatt.disconnect();
        document.getElementById('bleState').textContent = 'Disconnected';
      }
    }
  </script>
</body>
</html>
